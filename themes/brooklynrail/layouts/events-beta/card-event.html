{{/* ==========================
DATE Variables
The following variables transform dates and times for the event `start_date` and `end_date` and set them for use in the event page. */}}

<section class="card-event h-event">
  <header>

    <div class="grid-row grid-gap-2">

      <div class="grid-col-12 tablet-lg:grid-col-7 tablet-lg:order-2">

        {{/* Kicker + Collections */}}
        {{- if .Params.collections -}}
          <p class="kicker">
          {{- range $collection := (.GetTerms "collections") -}}
            {{/* Gets the Topics page */}}
            {{- $collection := $.Site.GetPage (printf "/%s/%s" "collections" $collection.Title) -}}
            <span class="collection">{{- $collection.Title -}}</span>
          {{- end -}}
          {{- with .Params.series -}}
            <span class="series"><span>#{{- . -}}</span></span>
          {{- end -}}
          </p>
        {{- end -}}

        {{- if .Params.Title -}}
        <h2 class="p-name">
          <a href="{{ .RelPermalink }}" title="{{- .Title -}}">{{- .Title | markdownify -}}</a>
        </h2>
        {{- end -}}

        {{- with .Params.Deck -}}
        <p class="deck">
          {{- . | markdownify -}}
        </p>
        {{- end -}}

      </div>


      <div class="grid-col-12 tablet-lg:grid-col-3 tablet-lg:order-1">

        {{/* NOTE:
        - `.Date` is recognized by HUGO as an official date
        - `.Params.end_date` is a string that needs to be converted to a date (still confused by this)
        */}}
        {{- $start_date := .Date -}}
        {{- $end_date := (time .Params.end_date) -}}
        {{/* This sets $future_event to true or false */}}
        {{- $future_event := (time .Params.end_date).After now -}}
        {{- if .Date -}}

        <div class="event-details">
          {{/* Start Date */}}
          <time class="dt-start" datetime="{{- dateFormat "2006-01-02T15:04:05Z07:00" (time $start_date) -}}">{{- dateFormat "Monday, January 2" (time $start_date) -}}</time>

          {{/* Hidden: This completes the `dt-end` value for the `h-event` microformat */}}
          <span class="hidden"> to <time class="dt-end" datetime="{{- dateFormat "2006-01-02T15:04:05Z07:00" (time $end_date) -}}">{{- dateFormat "Monday, January 2" (time $end_date) -}}</time></span>

          <p class="event-time">
            <span>{{- dateFormat "3:04" (time $start_date) -}}&nbsp;
            {{- $event_start_time_suffix := dateFormat "PM" (time $start_date) -}}
            {{- $event_start_time_suffix := replace $event_start_time_suffix "PM" "p.m." -}}
            {{- $event_start_time_suffix := replace $event_start_time_suffix "AM" "a.m." -}}
            {{- $event_start_time_suffix -}}&nbsp;ET</span>
            <span class="divider"> / </span>
            <span>{{ $event_start_time_suffix_pt := dateFormat "PM" ((time $start_date).Add ( -3 | duration "hour" )) -}}
            {{- $event_start_time_suffix_pt := replace $event_start_time_suffix_pt "PM" "p.m." -}}
            {{- $event_start_time_suffix_pt := replace $event_start_time_suffix_pt "AM" "a.m." -}}
            {{ dateFormat "3:04" ((time $start_date).Add ( -3 | duration "hour" )) -}}&nbsp;{{- $event_start_time_suffix_pt -}}&nbsp;PT</span>
          </p>
        </div>
        {{- end -}}

      </div>



      <div class="grid-col-12 tablet-lg:grid-col-2 tablet-lg:order-last">

        <div class="actions">
          {{- with .Params.registration_url -}}
            {{/* Registration button */}}
            <a class="u-white register" href="{{- $.Permalink -}}" title="More details"><button class="btn btn-sm btn-register" type="button" name="register"><span>Details</span></button></a>

            {{/* Add to Calendar */}}
            <div title="Add to Calendar" class="addeventatc" data-styling="none">
              <span>Add to Calendar</span>
              <span class="start">{{- dateFormat "2006-01-02 03:04 PM" (time $start_date) -}}</span>
              <span class="end">{{- dateFormat "2006-01-02 03:04 PM" (time $end_date) -}}</span>
              <span class="timezone">America/New_York</span>
              <span class="title">{{- (print $.Params.Title $.Params.deck )| markdownify -}}</span>
              <span class="description">{{- htmlUnescape (print $.Params.summary (print "\n\nEvent Page: https:" $.Permalink)) | safeHTML -}}</span>
              <span class="alarm_reminder">15</span>
            </div>

          {{- else -}}
            {{/* Coming soon */}}
            <p class="coming-soon">Registration coming soon. <span>Dates and times might change.</span></p>
          {{- end -}}
        </div>
      </div>
    </div>
  </header>
</section>
