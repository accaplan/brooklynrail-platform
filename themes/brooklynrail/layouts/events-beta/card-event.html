{{/* ==========================
DATE Variables
The following variables transform dates and times for the event `start_date` and `end_date` and set them for use in the event page. */}}

<section class="card-event h-event">
  <header>

    <div class="grid-row">
      <div class="grid-col-12 tablet-lg:grid-col-6">

        {{/* Kicker + Collections */}}
        {{- if .Params.collections -}}
          <p class="kicker">
          {{- range $collection := (.GetTerms "collections") -}}
            {{/* Gets the Topics page */}}
            {{- $collection := $.Site.GetPage (printf "/%s/%s" "collections" $collection.Title) -}}
            <span class="collection">{{- $collection.Title -}}</span>
          {{- end -}}
          {{- with .Params.series -}}
            <span class="series"><span>#{{- . -}}</span></span>
          {{- end -}}
          </p>
        {{- end -}}

        {{- if .Params.Title -}}
        <h2 class="p-name">
          <a href="{{ .RelPermalink }}" title="{{- .Title -}}">{{- .Title | markdownify -}}</a>
        </h2>
        {{- end -}}

        {{- with .Params.Deck -}}
        <p class="deck">
          {{- . | markdownify -}}
        </p>
        {{- end -}}

        {{- if .Params.Summary -}}
        <div class="summary content">
          <p>{{- .Params.Summary | markdownify -}}&nbsp;<a href="{{- .RelPermalink -}}" title="{{- .Title -}}">Details Â»</a></p>
        </div>
        {{- end -}}

        {{/* NOTE:
        - `.Date` is recognized by HUGO as an official date
        - `.Params.end_date` is a string that needs to be converted to a date (still confused by this)
        */}}
        {{- $start_date := .Date -}}
        {{- $end_date := (time .Params.end_date) -}}
        {{/* This sets $future_event to true or false */}}
        {{- $future_event := (time .Params.end_date).After now -}}
        {{- if .Date -}}

        <div class="event-details">
          <i class="far fa-calendar"></i>&nbsp;
          {{/* Start Date */}}
          <time class="dt-start" datetime="{{- dateFormat "2006-01-02T15:04:05Z07:00" (time $start_date) -}}">{{- dateFormat "Monday, January 2" (time $start_date) -}}</time>

          {{/* Hidden: This completes the `dt-end` value for the `h-event` microformat */}}
          <span class="hidden"> to <time class="dt-end" datetime="{{- dateFormat "2006-01-02T15:04:05Z07:00" (time $end_date) -}}">{{- dateFormat "Monday, January 2" (time $end_date) -}}</time></span>

          <p class="event-time">
            {{- dateFormat "3:04" (time $start_date) -}}&nbsp;
            {{- $event_start_time_suffix := dateFormat "PM" (time $start_date) -}}
            {{- $event_start_time_suffix := replace $event_start_time_suffix "PM" "p.m." -}}
            {{- $event_start_time_suffix := replace $event_start_time_suffix "AM" "a.m." -}}
            {{- $event_start_time_suffix -}}&nbsp;Eastern <span>/</span>
            {{ $event_start_time_suffix_pt := dateFormat "PM" ((time $start_date).Add ( -3 | duration "hour" )) -}}
            {{- $event_start_time_suffix_pt := replace $event_start_time_suffix_pt "PM" "p.m." -}}
            {{- $event_start_time_suffix_pt := replace $event_start_time_suffix_pt "AM" "a.m." -}}
            {{ dateFormat "3:04" ((time $start_date).Add ( -3 | duration "hour" )) -}}&nbsp;{{- $event_start_time_suffix_pt -}}&nbsp;Pacific
          </p>

          {{/* If is NOT a Future Event (Past event) */}}
          {{- if eq $future_event true -}}
            {{/* location */}}
            {{- $event_platform_data := $.Site.Data.event_platforms -}}
            {{- $event_platforms := .Params.event_platform -}}
            {{- if $event_platforms -}}
            <div class="event_platforms p-location">
              {{- range $i, $e := $event_platforms -}}
                {{- $platform := index $event_platform_data $e -}}
                <p class="{{- $e -}}"><span>On {{ $platform.name -}}</span></p>
              {{- end -}}
            </div>
            {{- end -}}
          {{- end -}}

        </div>
        {{- end -}}


      </div>

      <div class="grid-col-12 tablet-lg:grid-col-6">
        {{/* Speaker Images */}}
        {{- if .Params.speaker_images -}}
        <div class="speaker_images">
        {{- range $speaker_image := .Params.speaker_images -}}
          {{/* Gets the page data for this media in `/content/media` */}}
          {{- $image := $.Site.GetPage "page" (printf "/%s/%s" "media" $speaker_image.media) -}}
          {{- with $image -}}
            {{- template "figure" (dict "image" . "size" "xs" "width" "100" ) -}}
          {{- end -}}
        {{- end -}}
        </div>
        {{- end -}}
      </div>

    </div>

  </header>
</section>
